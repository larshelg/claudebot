# Job D - Execution Adapter

## Example Flow

1. **Job C emits a trade signal**: "Buy 1 BTC for ACC001 at $50,000"
2. **Job D receives the signal**
3. **Checks which venue to send it to** (e.g., BINANCE vs COINBASE)
4. **Converts it into a VenueOrder** with a unique order ID
5. **Stores in Flink pending state**
6. **Venue executes order**
7. **Returns execution report** (fill, partial fill, reject) asynchronously
8. **Job D updates Flink state** and emits the ExecReport
9. **Job C consumes ExecReports**
10. **Updates positions, portfolios, risk alerts**

## Why We Track Venue Info in Job D

`VenueOrder.venue` lets the system know which exchange the order belongs to.

**Needed for:**
- Correct routing
- Reconciliation of fills across multiple venues
- Risk management per venue

## Future Enhancements

- **Dynamic venue selection**: pick venue with best price/liquidity
- **Multi-venue splits**: one large order split across multiple venues
- **Failover**: if one venue fails, reroute order

> ðŸ’¡ **In short**: venues are the execution endpoints. Job D's main role is translating strategy signals into venue-specific orders and handling execution feedback.

---

## Step-by-Step Flow

### Job C â€” Strategy / Portfolio / Risk
- **Consumes**: trade_signals (generated by your strategy logic)
- **Maintains**: positions, portfolios, risk checks
- **Emits**: approved trade_signals to be executed

### Job D â€” Execution Adapter
- **Consumes**: trade_signals from Job C
- **Converts** signals into VenueOrders
- **Sends** orders to the selected venue(s)
- **Receives** async ExecReports (fills, partials, rejects)
- **Emits** ExecReports back to Job C (via Fluss or streams)

### Back to Job C
- **Updates** positions, portfolio, PnL
- **Updates** risk engine (triggers alerts if needed)
- **Strategy logic** can generate further signals

### Optional Persistence / Fluss
Trade signals, positions, portfolios, orders, and execution reports can all be persisted to Fluss for durability and cross-job sharing.

## Flow Diagram

```
   +-----------------+               +-------------------+
   |   Job C         |               |   Job D           |
   | Portfolio/Risk  |               | Execution Adapter |
   +-----------------+               +-------------------+
            |                                |
            | trade_signal (to execute)      |
            |------------------------------->|
            |                                |
            |                                | create VenueOrder
            |                                | send to Venue
            |                                |
            |                                | receive ExecReport
            |<-------------------------------|
            | update positions, portfolios   |
            | check risk / trigger alerts    |
            |                                |
            | (optional: generate more signals)
            |
```

## Legend / Notes

- **Job C â†’ Job D**: Trade signals approved for execution
- **Job D â†’ Venue(s)**: Converts to venue-specific orders, handles async fills
- **Venue â†’ Job D**: Execution reports
- **Job D â†’ Job C**: Reports back fills / rejects
- **State in Flink**: Positions, portfolio, pending orders
- **Persistence in Fluss**: Optional, for durability and cross-job access